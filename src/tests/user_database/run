#! /bin/bash
#-----------------------------------------------------------------------------
#--  Set up:

cd "$(dirname "$0")" || exit -1

errors=0

#-----------------------------------------------------------------------------
#--  Output from show_user_list:

./show_user_list \
  --alice-config-file ../../../exe/configuration/alice_config.ini \
  --yolk-config-file  ../../../exe/configuration/config.ini.dist \
  | diff -u show_user_list.expected_output - \
  > show_user_list.output_differences

if [ -s show_user_list.output_differences ]; then
   echo "Mismatch in output from 'show_user_list':"
   cat show_user_list.output_differences
   echo

   let errors++
fi

rm -f show_user_list.output_differences

#-----------------------------------------------------------------------------
#--  Output from show_openids:

./show_openids \
  --alice-config-file ../../../exe/configuration/alice_config.ini \
  --yolk-config-file  ../../../exe/configuration/config.ini.dist \
  | diff -u show_openids.expected_output - \
  > show_openids.output_differences

if [ -s show_openids.output_differences ]; then
   echo "Mismatch in output from 'show_openids':"
   cat show_openids.output_differences
   echo

   let errors++
fi

rm -f show_openids.output_differences

#-----------------------------------------------------------------------------
#--  Output from show_permissions:

./show_permissions \
  --alice-config-file ../../../exe/configuration/alice_config.ini \
  --yolk-config-file  ../../../exe/configuration/config.ini.dist \
  | diff -u show_permissions.expected_output - \
  > show_permissions.output_differences

if [ -s show_permissions.output_differences ]; then
   echo "Mismatch in output from 'show_permissions':"
   cat show_permissions.output_differences
   echo

   let errors++
fi

rm -f show_permissions.output_differences

#-----------------------------------------------------------------------------
#--  Report errors:

if [ ${errors} -gt 0 ]; then
   echo "Failed at ${errors} tests."
fi

#-----------------------------------------------------------------------------
#--  Exit status:

exit ${errors}

#-----------------------------------------------------------------------------
